<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مواقيت الصلاة - عمّان</title>
    
    <!-- === الإضافات الجديدة لـ PWA === -->
    <meta name="theme-color" content="#0D1B2A">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-1024.png">
    <link rel="apple-touch-icon" href="icon-1024.png">
    <!-- ============================= -->
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0D1B2A;
            --card-color: #1B263B;
            --text-color: #E0E1DD;
            --primary-color: #E1C56E;
            --disabled-color: #4A5568;
        }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            /* تعديل: تم إزالة التوسيط العمودي وإرجاع padding علوي */
            padding: 25px 15px 15px 15px;
            box-sizing: border-box;
            min-height: 100vh;
            display: flex;
            justify-content: center; /* للتوسيط الأفقي فقط */
        }
        .container {
            width: 100%;
            max-width: 800px;
            text-align: center;
        }
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            line-height: 1.7; 
        }
        #current-date-header {
            color: var(--primary-color);
            font-size: 1rem;
            margin: 0 0 1.5rem 0;
            min-height: 1.2em;
        }
        .prayer-times-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .prayer-card {
            background-color: var(--card-color);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .prayer-card h2 { margin: 0 0 8px; font-size: 1rem; color: var(--primary-color); font-weight: 600; }
        .prayer-card p { margin: 0; font-size: 1.4rem; font-weight: bold; }
        .prayer-card.active { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(225, 197, 110, 0.3); }
        .next-prayer-container { background-color: var(--card-color); border-radius: 8px; padding: 15px; margin-top: 1.5rem; }
        #next-prayer-name { color: var(--primary-color); font-size: 1.1rem; font-weight: 600; }
        #timer { margin: 0; font-size: 1.9rem; font-weight: bold; }
        
        .navigation-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4.5rem; 
        }
        .nav-arrow {
            background: var(--card-color);
            border: none;
            color: var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 5px;
            -webkit-tap-highlight-color: transparent;
        }
        .nav-arrow:hover:not(:disabled) { background-color: #2a3b52; }
        .nav-arrow:disabled { color: var(--disabled-color); background-color: var(--card-color); cursor: not-allowed; opacity: 0.5; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>مواقيت الصلاة لمدينة<br>عمّان</h1>
            <p id="current-date-header"></p>
        </header>
        <main>
            <div class="prayer-times-grid">
                <div class="prayer-card" id="fajr-card"><h2>الفجر</h2><p id="fajr-time">--:--</p></div>
                <div class="prayer-card" id="sunrise-card"><h2>الشروق</h2><p id="sunrise-time">--:--</p></div>
                <div class="prayer-card" id="dhuhr-card"><h2>الظهر</h2><p id="dhuhr-time">--:--</p></div>
                <div class="prayer-card" id="asr-card"><h2>العصر</h2><p id="asr-time">--:--</p></div>
                <div class="prayer-card" id="maghrib-card"><h2>المغرب</h2><p id="maghrib-time">--:--</p></div>
                <div class="prayer-card" id="isha-card"><h2>العشاء</h2><p id="isha-time">--:--</p></div>
            </div>
            <div class="next-prayer-container" id="countdown-container">
                <span id="next-prayer-name"></span>
                <p id="timer"></p>
            </div>
            <div class="navigation-controls">
                <button id="prev-day-btn" class="nav-arrow" aria-label="اليوم السابق">&lt;</button>
                <button id="next-day-btn" class="nav-arrow" aria-label="اليوم التالي">&gt;</button>
            </div>
        </main>
    </div>

    <script>
        const csvData = `DATE,FAJR,SUNRISE,DHUHR,ASR,MAGHRIB,ISHA
2025-10-31,5:29,6:46,12:20,3:25,5:54,7:10
2025-11-01,5:30,6:47,12:20,3:24,5:53,7:10
2025-11-02,5:31,6:47,12:20,3:23,5:52,7:09
2025-11-03,5:31,6:48,12:20,3:23,5:51,7:08
2025-11-04,5:32,6:49,12:20,3:22,5:50,7:07
2025-11-05,5:33,6:50,12:20,3:22,5:50,7:07
2025-11-06,5:34,6:51,12:20,3:21,5:49,7:06
2025-11-07,5:34,6:52,12:20,3:20,5:48,7:05
2025-11-08,5:35,6:52,12:20,3:20,5:47,7:05
2025-11-09,5:36,6:53,12:21,3:19,5:47,7:04
2025-11-10,5:37,6:54,12:21,3:19,5:46,7:04
2025-11-11,5:37,6:55,12:21,3:18,5:45,7:03
2025-11-12,5:38,6:56,12:21,3:18,5:45,7:03
2025-11-13,5:39,6:57,12:21,3:17,5:44,7:02
2025-11-14,5:40,6:58,12:21,3:17,5:44,7:02
2025-11-15,5:40,6:58,12:21,3:17,5:43,7:01
2025-11-16,5:41,6:59,12:21,3:16,5:43,7:01
2025-11-17,5:42,7:00,12:22,3:16,5:42,7:01
2025-11-18,5:43,7:01,12:22,3:15,5:42,7:00
2025-11-19,5:43,7:02,12:22,3:15,5:41,7:00
2025-11-20,5:44,7:03,12:22,3:15,5:41,7:00
2025-11-21,5:45,7:04,12:23,3:15,5:41,6:59
2025-11-22,5:46,7:05,12:23,3:14,5:40,6:59
2025-11-23,5:46,7:05,12:23,3:14,5:40,6:59
2025-11-24,5:47,7:06,12:23,3:14,5:40,6:59
2025-11-25,5:48,7:07,12:24,3:14,5:39,6:59
2025-11-26,5:49,7:08,12:24,3:14,5:39,6:59
2025-11-27,5:49,7:09,12:24,3:14,5:39,6:58
2025-11-28,5:50,7:10,12:25,3:13,5:39,6:58
2025-11-29,5:51,7:11,12:25,3:13,5:39,6:58
2025-11-30,5:52,7:11,12:25,3:13,5:39,6:58
2025-12-01,5:52,7:12,12:26,3:13,5:38,6:58
2025-12-02,5:53,7:13,12:26,3:13,5:38,6:58
2025-12-03,5:54,7:14,12:27,3:13,5:38,6:58
2025-12-04,5:54,7:15,12:27,3:13,5:38,6:59
2025-12-05,5:55,7:15,12:27,3:14,5:38,6:59
2025-12-06,5:56,7:16,12:28,3:14,5:39,6:59
2025-12-07,5:57,7:17,12:28,3:14,5:39,6:59
2025-12-08,5:57,7:18,12:29,3:14,5:39,6:59
2025-12-09,5:58,7:18,12:29,3:14,5:39,6:59
2025-12-10,5:59,7:19,12:30,3:14,5:39,7:00
2025-12-11,5:59,7:20,12:30,3:15,5:39,7:00
2025-12-12,6:00,7:21,12:30,3:15,5:40,7:00
2025-12-13,6:00,7:21,12:31,3:15,5:40,7:01
2025-12-14,6:01,7:22,12:31,3:16,5:40,7:01
2025-12-15,6:02,7:23,12:32,3:16,5:40,7:01
2025-12-16,6:02,7:23,12:32,3:16,5:41,7:02
2025-12-17,6:03,7:24,12:33,3:17,5:41,7:02
2025-12-18,6:03,7:24,12:33,3:17,5:42,7:03
2025-12-19,6:04,7:25,12:34,3:18,5:42,7:03
2025-12-20,6:05,7:25,12:34,3:18,5:43,7:03
2025-12-21,6:05,7:26,12:35,3:18,5:43,7:04
2025-12-22,6:06,7:26,12:35,3:19,5:44,7:04
2025-12-23,6:06,7:27,12:36,3:20,5:44,7:05
2025-12-24,6:06,7:27,12:36,3:20,5:45,7:06
2025-12-25,6:07,7:28,12:37,3:21,5:45,7:06
2025-12-26,6:07,7:28,12:37,3:21,5:46,7:07
2025-12-27,6:08,7:29,12:38,3:22,5:46,7:07
2025-12-28,6:08,7:29,12:38,3:22,5:47,7:08
2025-12-29,6:08,7:29,12:39,3:23,5:48,7:08
2025-12-30,6:09,7:30,12:39,3:24,5:48,7:09
2025-12-31,6:09,7:30,12:40,3:24,5:49,7:10`;

        document.addEventListener('DOMContentLoaded', () => {
            const prayerData = new Map(
                csvData.trim().split('\n').slice(1).map(line => {
                    const [date, fajr, sunrise, dhuhr, asr, maghrib, isha] = line.split(',');
                    return [date, { FAJR: fajr, SUNRISE: sunrise, DHUHR: dhuhr, ASR: asr, MAGHRIB: maghrib, ISHA: isha }];
                })
            );

            const prayerNames = { FAJR: 'الفجر', SUNRISE: 'الشروق', DHUHR: 'الظهر', ASR: 'العصر', MAGHRIB: 'المغرب', ISHA: 'العشاء' };
            const elements = {
                fajrTime: document.getElementById('fajr-time'), sunriseTime: document.getElementById('sunrise-time'),
                dhuhrTime: document.getElementById('dhuhr-time'), asrTime: document.getElementById('asr-time'),
                maghribTime: document.getElementById('maghrib-time'), ishaTime: document.getElementById('isha-time'),
                fajrCard: document.getElementById('fajr-card'), sunriseCard: document.getElementById('sunrise-card'),
                dhuhrCard: document.getElementById('dhuhr-card'), asrCard: document.getElementById('asr-card'),
                maghribCard: document.getElementById('maghrib-card'), ishaCard: document.getElementById('isha-card'),
                nextPrayerName: document.getElementById('next-prayer-name'), timer: document.getElementById('timer'),
                countdownContainer: document.getElementById('countdown-container'), nextDayBtn: document.getElementById('next-day-btn'),
                prevDayBtn: document.getElementById('prev-day-btn'),
                currentDateHeader: document.getElementById('current-date-header')
            };
            
            let displayedDate = new Date();
            let countdownInterval = null;

            function getDateString(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }

            function formatTimeForDisplay(timeStr) {
                if (!timeStr) return '--:--';
                let [hour, minute] = timeStr.split(':');
                let h = parseInt(hour, 10);
                const ampm = (h < 12) ? 'ص' : 'م';
                h = h % 12;
                if (h === 0) h = 12;
                return `${h}:${minute} ${ampm}`;
            }

            function updateUIForDate(date) {
                clearInterval(countdownInterval);
                const dateKey = getDateString(date);
                const dayData = prayerData.get(dateKey);

                elements.currentDateHeader.textContent = date.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                Object.keys(prayerNames).forEach(key => {
                    const element = elements[`${key.toLowerCase()}Time`];
                    if (element) {
                        element.textContent = dayData ? formatTimeForDisplay(dayData[key]) : '--:--';
                    }
                });

                const isToday = (new Date()).toDateString() === date.toDateString();
                
                elements.countdownContainer.style.visibility = isToday ? 'visible' : 'hidden';

                document.querySelectorAll('.prayer-card').forEach(c => c.classList.remove('active'));

                if (isToday) {
                    startCountdown();
                    countdownInterval = setInterval(startCountdown, 1000);
                }
                
                updateNavigation(date);
            }

            function updateNavigation(date) {
                const today = new Date(); today.setHours(0, 0, 0, 0);
                const dateArray = Array.from(prayerData.keys());
                const lastDate = new Date(dateArray[dateArray.length - 1]); lastDate.setHours(0, 0, 0, 0);
                const currentDay = new Date(date); currentDay.setHours(0, 0, 0, 0);

                elements.prevDayBtn.disabled = currentDay <= today;
                elements.nextDayBtn.disabled = currentDay >= lastDate;
            }

            function startCountdown() {
                const now = new Date();
                const dateKey = getDateString(now);
                const dayData = prayerData.get(dateKey);
                if (!dayData) return;

                const prayerTimesToday = Object.keys(prayerNames).map(name => {
                    const time = dayData[name];
                    if (!time) return null;
                    const [h, m] = time.split(':');
                    return { name, nameAr: prayerNames[name], card: elements[`${name.toLowerCase()}Card`], date: new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m) };
                }).filter(Boolean);

                let currentPrayer = null, nextPrayer = null;
                for (const prayer of prayerTimesToday) {
                    if (now >= prayer.date) currentPrayer = prayer;
                    if (now < prayer.date && !nextPrayer) nextPrayer = prayer;
                }

                document.querySelectorAll('.prayer-card').forEach(c => c.classList.remove('active'));
                if (currentPrayer) currentPrayer.card.classList.add('active');

                if (nextPrayer) {
                    elements.nextPrayerName.textContent = `لصلاة ${nextPrayer.nameAr}`;
                    elements.timer.textContent = getCountdownString(nextPrayer.date - now);
                } else {
                    elements.nextPrayerName.textContent = 'انتهت صلوات اليوم';
                    elements.timer.textContent = 'تقبل الله';
                }
            }
            
            function getCountdownString(diff) {
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            }

            elements.nextDayBtn.addEventListener('click', () => {
                displayedDate.setDate(displayedDate.getDate() + 1);
                updateUIForDate(displayedDate);
            });
            elements.prevDayBtn.addEventListener('click', () => {
                displayedDate.setDate(displayedDate.getDate() - 1);
                updateUIForDate(displayedDate);
            });

            // --- Initial Load ---
            updateUIForDate(displayedDate);
        });
    </script>
    
    <!-- === سكريبت تسجيل الـ Service Worker === -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
    
</body>
</html>